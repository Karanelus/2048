(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();class p{constructor(){this.score=0,this.status="idle",this.cells=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}slide(r){const s=r.sort((e,t)=>e-t);for(let e=0;e<s.length;e++)s[e]===s[e+1]&&(s[e+1]=s[e]*2,s[e]=0)}slideAndMerge(r){const s=r.filter(e=>e!==0);for(let e=0;e<s.length-1;e++)s[e]===s[e+1]&&(s[e]*=2,this.score+=s[e],s.splice(e+1,1));for(;s.length<4;)s.push(0);return s}transpose(r){return r[0].map((s,e)=>r.map(t=>t[e]))}isWin(){this.cells.some(r=>r.some(s=>s===2048))&&(this.status="win")}isLose(){this.cells.every((s,e)=>s.every((t,n)=>!(t===0||n<3&&t===this.cells[e][n+1]||e<3&&t===this.cells[e+1][n])))&&(this.status="lose")}moveRight(){this.cells=this.cells.map(r=>{const s=r.reverse();return this.slideAndMerge(s).reverse()})}moveLeft(){this.cells=this.cells.map(r=>this.slideAndMerge(r))}moveUp(){const s=this.transpose(this.cells).map(e=>this.slideAndMerge(e));this.cells=this.transpose(s)}moveDown(){const s=this.transpose(this.cells).map(e=>this.slideAndMerge(e.reverse()).reverse());this.cells=this.transpose(s)}getScore(){return this.score}getState(){return this.cells}getStatus(){return this.status}nextTurn(){const r=Math.random()<.9?2:4,s=[];if(this.cells.forEach((e,t)=>e.forEach((n,i)=>{n===0&&s.push([t,i])})),s.length>0){const[e,t]=s[Math.floor(Math.random()*s.length)];this.cells[e][t]=r}this.isWin(),this.isLose()}start(){this.status="playing",this.nextTurn(),this.nextTurn()}restart(){return this.cells=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.score=0,this.status="idle",this}}const o=new p,g=[...document.querySelectorAll(".field-row")],c=document.querySelector(".button"),w=document.querySelector(".game-score"),u=document.querySelector(".message-win"),h=document.querySelector(".message-lose"),d=document.querySelector(".message-start"),f=()=>{const l=o.cells;g.forEach((r,s)=>{[...r.querySelectorAll(".field-cell")].forEach((t,n)=>{t.className="field-cell",t.innerText="";const i=l[s][n];i>0&&(t.classList.add(`field-cell--${i}`),t.innerText=i)})})},a=l=>{o.status==="playing"&&(l(),o.nextTurn(),w.innerText=o.getScore(),f(),v())},m=l=>{switch(l.key){case"ArrowUp":a(()=>o.moveUp());break;case"ArrowDown":a(()=>o.moveDown());break;case"ArrowLeft":a(()=>o.moveLeft());break;case"ArrowRight":a(()=>o.moveRight());break}};c.addEventListener("click",()=>{o.status==="idle"?(o.start(),c.classList.replace("start","restart"),c.innerText="Restart",d.classList.add("hidden")):(o.restart(),c.classList.replace("restart","start"),c.innerText="Start",d.classList.remove("hidden")),document[o.status==="playing"?"addEventListener":"removeEventListener"]("keydown",m),h.classList.add("hidden"),u.classList.add("hidden"),f()});function v(){(o.status==="win"||o.status==="lose")&&((o.status==="win"?u:h).classList.remove("hidden"),d.classList.add("hidden"),document.removeEventListener("keydown",m))}
